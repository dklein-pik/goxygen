.empty <- function(zz) {
  writeLines("",zz)
}

.write <- function(zz,data,quote=NULL) {
  if(!is.null(quote)) data <- .quoteObjects(data,quote)
  if(!is.null(data)) writeLines(data,zz)
  .empty(zz)
}

.header <- function(zz,title,level,id=NULL) {
  if(length(title)>1) {
    warning("Multiline entry to title detected. Only first line will be used!")
    title <- title[1]
  }
  if(!is.null(id)) id <- paste0(" {#id-",id,"}")
  if(level<3) {
    writeLines(paste0(title,id),zz)
    symbol <- ifelse(level==1,"=","-")
    writeLines(paste(rep(symbol,nchar(title)), collapse=""),zz)
  } else {
    start <- paste(rep("#",level),collapse="")
    writeLines(paste(start,title),zz)
  }
  .empty(zz)
}

.interfaceplot <- function(zz,name) {
  file <- paste0("images/interfaces_",sub("^.*_","",name),".png")
  if(file.exists(file)) {
    .write(zz,paste0("![Interfaces to other modules](",file,"){ height=50% width=100% }"))
  } else {
    .write(zz,"**Interface plot missing!**") 
  }
}

.limitations <- function(zz,limitations, quote=NULL) {
  if(is.null(limitations)) limitations <- "There are no known limitations."
  limitations <- c("**Limitations**",limitations)
  limitations <- paste(">",limitations)
  .write(zz,limitations, quote=quote)
}

.updateImagePaths <- function(x){
  return(gsub("\\(([^/]*\\.(png|jpg))\\)","(images/\\1)",x))
}

.quoteObjects <- function(x,objects) {
  objects <- gsub("([.|()\\^{}+$*?]|\\[|\\])", "\\\\\\1", objects, perl=TRUE)
  pattern <-paste0("(`*",paste(objects,collapse="|"),"`?)")
  x <- gsub(pattern,"`\\1`",x, perl=TRUE)
  return(x)
}
